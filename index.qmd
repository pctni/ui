---
# title: "PCTNI: Propensity to Cycle Tool for Northern Ireland"
# format: dashboard
execute: 
  include: false
  echo: false
format: 
  html:
    page-layout: full
---

```{=html}
<style>
/* Override Quarto's default layout but preserve header */
body, html {
  margin: 0 !important;
  padding: 0 !important;
  overflow-x: hidden;
}

/* Reset all Quarto containers except header */
.quarto-container:not(#quarto-header .quarto-container),
.container:not(#quarto-header .container),
.container-fluid:not(#quarto-header .container-fluid),
main,
.content,
#quarto-content {
  max-width: none !important;
  width: 100% !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* Map container - position below header */
.map-layout {
  position: fixed;
  top: 60px;
  left: 0;
  display: flex;
  width: 100vw;
  height: calc(100vh - 60px);
  margin: 0;
  padding: 0;
  z-index: 100;
}

/* Make the iframe take 75% width */
.map-iframe {
  width: 75vw;
  height: 100%;
  border: none;
  margin: 0;
  padding: 0;
}

/* Right panel for layer controls */
.legend-panel {
  width: 25vw;
  height: 100%;
  background-color: #f8f9fa;
  border-left: 2px solid #dee2e6;
  overflow-y: auto;
  padding: 0;
  box-sizing: border-box;
  margin: 0;
  font-family: Arial, sans-serif;
}

.legend-panel h3 {
  color: #333;
  font-size: 18px;
  margin: 0;
  padding: 20px 20px 15px 20px;
  border-bottom: 2px solid #dee2e6;
  background-color: #fff;
}

/* Tab styles */
.tab-container {
  background-color: #fff;
}

.tab-nav {
  display: flex;
  border-bottom: 1px solid #dee2e6;
  background-color: #f8f9fa;
}

.tab-button {
  flex: 1;
  padding: 12px 8px;
  background: none;
  border: none;
  cursor: pointer;
  font-size: 12px;
  font-weight: bold;
  color: #666;
  border-bottom: 3px solid transparent;
  transition: all 0.3s ease;
}

.tab-button:hover {
  background-color: #e9ecef;
  color: #333;
}

.tab-button.active {
  color: #0066cc;
  border-bottom-color: #0066cc;
  background-color: #fff;
}

.tab-content {
  display: none;
  padding: 20px;
}

.tab-content.active {
  display: block;
}

/* Control styles */
.control-group {
  margin-bottom: 20px;
}

.control-group label {
  display: block;
  font-weight: bold;
  color: #333;
  margin-bottom: 8px;
  font-size: 14px;
}

.control-group select {
  width: 100%;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 13px;
  background-color: #fff;
}

/* Legend styles */
.legend-item {
  margin-bottom: 20px;
  padding: 12px;
  background: #f8f9fa;
  border-radius: 6px;
  border: 1px solid #dee2e6;
}

.legend-item h4 {
  color: #495057;
  font-size: 14px;
  margin: 0 0 12px 0;
  font-weight: bold;
}

/* Horizontal color bar styles */
.color-bar-container {
  margin-bottom: 15px;
}

.color-bar {
  width: 100%;
  height: 20px;
  border: 1px solid #999;
  border-radius: 3px;
  position: relative;
}

.cycling-bar {
  background: linear-gradient(to right, 
    #808080 0%,      /* 1- (grey) */
    #ffff80 12.5%,   /* 50- (light yellow) */
    #80ff80 25%,     /* 100- (light green) */
    #80ffff 37.5%,   /* 250- (cyan) */
    #8080ff 50%,     /* 500- (light blue) */
    #0000ff 62.5%,   /* 1000- (blue) */
    #8000ff 75%,     /* 2000- (purple) */
    #ff00ff 87.5%,   /* 3000- (magenta) */
    #ff80ff 100%     /* 3000+ (light magenta) */
  );
}

.coherent-bar {
  background: linear-gradient(to right, 
    #ffcccc 0%,      /* Low coherence (light red) */
    #ff9999 25%,     /* Medium-low (light red) */
    #66ccff 50%,     /* Medium (light blue) */
    #3399ff 75%,     /* Medium-high (blue) */
    #0066cc 100%     /* High coherence (dark blue) */
  );
}

.gap-bar {
  background: linear-gradient(to right, 
    #00ff00 0%,      /* No gap (green) */
    #80ff80 25%,     /* Small gap (light green) */
    #ffff00 50%,     /* Medium gap (yellow) */
    #ff8000 75%,     /* Large gap (orange) */
    #ff0000 100%     /* Critical gap (red) */
  );
}

.color-bar-labels {
  display: flex;
  justify-content: space-between;
  font-size: 10px;
  color: #666;
  margin-top: 5px;
  padding: 0 2px;
}

.color-bar-label {
  text-align: center;
  flex: 1;
}

/* Layer toggle styles */
.layer-toggle {
  margin-bottom: 8px;
}

.layer-toggle input[type="checkbox"] {
  margin-right: 8px;
}

.layer-toggle label {
  font-weight: normal;
  cursor: pointer;
  font-size: 13px;
  color: #666;
}

/* Discrete legend items */
.legend-color-item {
  display: flex;
  align-items: center;
  margin-bottom: 6px;
  font-size: 12px;
}

.legend-color-box {
  width: 18px;
  height: 12px;
  margin-right: 8px;
  border: 1px solid #999;
  border-radius: 2px;
}

/* Ensure header stays visible and positioned correctly */
#quarto-header {
  position: relative !important;
  z-index: 1001 !important;
}
</style>

<div class="map-layout">
  <iframe src="pmtiles_map.html" title="Map" class="map-iframe"></iframe>
  
  <div class="legend-panel">
    <h3>Layer controls</h3>
    
    <div class="tab-container">
      <div class="tab-nav">
        <button class="tab-button active" onclick="switchTab(event, 'route-network')">Route network</button>
        <button class="tab-button" onclick="switchTab(event, 'coherent-network')">Coherent network</button>
        <button class="tab-button" onclick="switchTab(event, 'gap-analysis')">Gap analysis</button>
      </div>
      
      <!-- Route Network Tab -->
      <div id="route-network" class="tab-content active">
        <div class="control-group">
          <div class="layer-toggle">
            <input type="checkbox" id="show-layer-route">
            <label for="show-layer-route">Show layer</label>
          </div>
        </div>
        
        <div class="control-group">
          <label for="network-type">Network type</label>
          <select id="network-type">
            <option value="fast">Fast</option>
            <option value="quiet">Quiet</option>
          </select>
        </div>
        
        <div class="legend-item">
          <h4>Cycling potential (Go Dutch)</h4>
          <div class="color-bar-container">
            <div class="color-bar cycling-bar"></div>
            <div class="color-bar-labels">
              <span class="color-bar-label">1-</span>
              <span class="color-bar-label">50-</span>
              <span class="color-bar-label">100-</span>
              <span class="color-bar-label">250-</span>
              <span class="color-bar-label">500-</span>
              <span class="color-bar-label">1000-</span>
              <span class="color-bar-label">2000-</span>
              <span class="color-bar-label">3000-</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Coherent Network Tab -->
      <div id="coherent-network" class="tab-content">
        <div class="control-group">
          <div class="layer-toggle">
            <input type="checkbox" id="show-layer-coherent">
            <label for="show-layer-coherent">Show layer</label>
          </div>
        </div>
        
        <div class="legend-item">
          <h4>Network Coherence</h4>
          <div class="color-bar-container">
            <div class="color-bar coherent-bar"></div>
            <div class="color-bar-labels">
              <span class="color-bar-label">Low</span>
              <span class="color-bar-label">Med-Low</span>
              <span class="color-bar-label">Medium</span>
              <span class="color-bar-label">Med-High</span>
              <span class="color-bar-label">High</span>
            </div>
          </div>
        </div>
        
        <div class="legend-item">
          <h4>Infrastructure Types</h4>
          <div class="legend-color-item">
            <div class="legend-color-box" style="background-color: #0066cc;"></div>
            <span>Primary Cycle Route</span>
          </div>
          <div class="legend-color-item">
            <div class="legend-color-box" style="background-color: #3399ff;"></div>
            <span>Secondary Cycle Route</span>
          </div>
          <div class="legend-color-item">
            <div class="legend-color-box" style="background-color: #66ccff;"></div>
            <span>Local Cycle Route</span>
          </div>
          <div class="legend-color-item">
            <div class="legend-color-box" style="background-color: #99ddff;"></div>
            <span>Shared Path</span>
          </div>
        </div>
      </div>
      
      <!-- Gap Analysis Tab -->
      <div id="gap-analysis" class="tab-content">
        <div class="control-group">
          <div class="layer-toggle">
            <input type="checkbox" id="show-layer-gap">
            <label for="show-layer-gap">Show layer</label>
          </div>
        </div>
        
        <div class="legend-item">
          <h4>Infrastructure Gaps</h4>
          <div class="color-bar-container">
            <div class="color-bar gap-bar"></div>
            <div class="color-bar-labels">
              <span class="color-bar-label">None</span>
              <span class="color-bar-label">Small</span>
              <span class="color-bar-label">Medium</span>
              <span class="color-bar-label">Large</span>
              <span class="color-bar-label">Critical</span>
            </div>
          </div>
        </div>
        
        <div class="legend-item">
          <h4>Gap Priorities</h4>
          <div class="legend-color-item">
            <div class="legend-color-box" style="background-color: #ff0000;"></div>
            <span>Critical Priority</span>
          </div>
          <div class="legend-color-item">
            <div class="legend-color-box" style="background-color: #ff8000;"></div>
            <span>High Priority</span>
          </div>
          <div class="legend-color-item">
            <div class="legend-color-box" style="background-color: #ffff00;"></div>
            <span>Medium Priority</span>
          </div>
          <div class="legend-color-item">
            <div class="legend-color-box" style="background-color: #80ff80;"></div>
            <span>Low Priority</span>
          </div>
          <div class="legend-color-item">
            <div class="legend-color-box" style="background-color: #00ff00;"></div>
            <span>No Gap</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function switchTab(evt, tabName) {
  // Hide all tab contents
  var tabContents = document.getElementsByClassName("tab-content");
  for (var i = 0; i < tabContents.length; i++) {
    tabContents[i].classList.remove("active");
  }
  
  // Remove active class from all tab buttons
  var tabButtons = document.getElementsByClassName("tab-button");
  for (var i = 0; i < tabButtons.length; i++) {
    tabButtons[i].classList.remove("active");
  }
  
  // Show the selected tab content and mark button as active
  document.getElementById(tabName).classList.add("active");
  evt.currentTarget.classList.add("active");
  
  // Send message to iframe to switch layer if needed
  var iframe = document.querySelector('.map-iframe');
  if (iframe && iframe.contentWindow) {
    iframe.contentWindow.postMessage({
      type: 'switchLayer',
      layer: tabName
    }, '*');
  }
}

// Handle show layer checkboxes and network type changes
document.addEventListener('change', function(e) {
  var iframe = document.querySelector('.map-iframe');
  if (!iframe || !iframe.contentWindow) return;
  
  if (e.target.id === 'network-type') {
    iframe.contentWindow.postMessage({
      type: 'changeNetworkType',
      networkType: e.target.value
    }, '*');
  } else if (e.target.id === 'show-layer-route') {
    iframe.contentWindow.postMessage({
      type: 'toggleLayer',
      show: e.target.checked
    }, '*');
  } else if (e.target.id === 'show-layer-coherent') {
    iframe.contentWindow.postMessage({
      type: 'toggleLayer',
      show: e.target.checked
    }, '*');
  } else if (e.target.id === 'show-layer-gap') {
    iframe.contentWindow.postMessage({
      type: 'toggleLayer',
      show: e.target.checked
    }, '*');
  }
});
</script>
```

<!-- # Introduction

Evidence on cycling potential at the network can inform more cost-effective investment and help ensure that the schemes offering most 'boom for buck' are prioritised in planned pipelines of work.
The proposal is to develop a Propensity to Cycle Tool for Northern Ireland (PCTNI) to help achieve these aims.
The work can move quickly because all input datasets for a 'fastrack' version of the tool are available and the team has experience in developing similar tools for other parts of the UK and Ireland.
An early prototype of the results has already been developed to demonstrate the approach.

## Existing Tools and Resources

-   The PCT for England and Wales: [www.pct.bike](https://www.pct.bike/)
    -   Main tool for strategic network planning
    -   Large multi-year DfT funded project
    -   Built foundations that led to more cost-efficient projects
-   The CRUSE tool for Republic of Ireland: [www.cruse.bike](https://www.cruse.bike/)
    -   Deployed across all of Ireland
    -   Added functionality for multiple trip purposes
    -   Uses origin-destination data with 'odjitter' software
    -   Provides estimates of current and potential future cycling levels
-   The NPT for Scotland: [www.npt.scot](https://www.npt.scot/)
    -   Web application for strategic cycle network planning
    -   Original "fast track" version delivered within 3 months
    -   Based on commuting data -->

